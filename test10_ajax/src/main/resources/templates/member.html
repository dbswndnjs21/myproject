<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
</head>
<body>
<h1 id="title">회원등록</h1>
<form method="post" th:action="@{/member/join}">
    아이디 <input type="text" name="id" id="id"> <br>
    비밀번호 <input type="password" name="pwd" id="pwd"> <br>
    이메일 <input type="text" name="email" id="email"> <br>
    나이 <input type="text" name="age" id="age"> <br>
     <input type="submit" value="가입" id="submit"> <br>
</form>
<div>
    <table class="table" id="memList">

    </table>
</div>

<script th:inline="javascript">
    // $("form").submit(function (e){ // form태그명
    //     e.preventDefault(); // submit안되게하는것 (해당 이벤트 수행하지못하게)
    //     let param = $(this).serialize(); // this -> form 의 쿼리스트링 문자열
    //     $.ajax({
    //         url:'/member/join',
    //         type:'post',
    //         data:param,
    //         success:function (data){
    //             console.log(data)
    //             alert('success');
    //         }
    //     })
    // })

    function list(){
        $.ajax({
            url: '/member/list',
            type:'get',
            success:function (data){
                $("#memList").empty();
                let th = "<tr><th>아이디</th><th>이메일</th><th>나이</th><th>가입일</th><th>수정</th><th>삭제</th>";
                $("memList").append(th);
                $(data).each(function (i, mem) {
                    console.log(mem)
                    let tr = "<tr>" +
                        "<td>" + mem.id + "</td>" +
                        "<td>" + mem.email + "</td>" +
                        "<td>" + mem.age + "</td>" +
                        "<td>" + mem.regdate + "</td>" +
                        "<td><a href=\"javascript:update('" + mem.id + "')\">수정</a></td>" +
                        "<td><a href=\"javascript:deleteMember('" + mem.id + "')\">삭제</a></td>" +
                        "</tr>"
                    $("#memList").append(tr)
                });
            }
        })
    }
list();

    function deleteMember(id) {
        $.ajax({
            url:'/member/delete/'+ id,
            type:'delete',
            success:function (msg) {
                alert(msg)
                list();
            }
        })
    }

    function update(id){
        $.ajax({
            url:'/member/findById/'+id,
            type:'get',
            success:function (data){
                document.getElementById('id').value = data.id; // $("#id).val(data.id);
                document.getElementById('pwd').value = data.pwd;
                document.getElementById('email').value = data.email;
                document.getElementById('age').value = data.age;
                document.getElementById('title').innerText= "회원수정";
                document.getElementById('submit').value = "수정";
            }
        })
    }

    $("form").submit(function (e) { // form태그명
        let submit = $("#submit").val();
        let param = $(this).serialize();

        let data={"id":$("#id").val(),
            "pwd":$("#pwd").val(),
            "email":$("#email").val(),
            "age":$("#age").val() }
        let jsonParam= JSON.stringify(data);
        console.log(jsonParam);
        if (submit == "수정") {
            e.preventDefault();
            $.ajax({
                url: '/member/update',
                type: 'put',
                contentType:'application/json',
                data: jsonParam,
                success: function (msg) {
                    alert(msg)
                    $("#submit").val("가입");
                    $("#title").val("회원등록")
                    $("#id").val("");
                    $("#pwd").val("");
                    $("#email").val("");
                    $("#age").val("");
                    list();
                }
            });
        } else {
            e.preventDefault(); // submit안되게하는것 (해당 이벤트 수행하지못하게)
            $.ajax({
                url: '/member/join',
                type: 'post',
                data: param,
                success: function (data) {
                    console.log(data)
                    alert('success');
                    list();
                }
            })
        }
    });



</script>
</body>
</html>